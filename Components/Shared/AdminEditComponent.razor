@* @inject LusiumService LusiumService
@rendermode InteractiveServer

<h1>Editar Administrador</h1>

<div class="form-group">
    <label for="nome">Nome</label>
    <input type="text"
           class="form-control"
           id="name"
           @bind="userName"
           placeholder="@userName"
           readonly />
    <label for="password">Nova Palavra-passe</label>
    <input type="password" class="form-control" id="password" @bind="password" />
    <label for="confirmPassword">Confirmar Nova Palavra-passe</label>
    <input type="password" class="form-control" id="confirmPassword" @bind="confirmPassword" />
</div>

<button @onclick="EditAdmin">Alterar Dados</button>

<p>@message</p>

@code {
    private string userID { get; set; } = string.Empty;
    private string userName { get; set; } = string.Empty;
    private string userEmail { get; set; } = string.Empty;

    private string password { get; set; } = string.Empty;
    private string confirmPassword { get; set; } = string.Empty;

    private string message { get; set; } = string.Empty;

    private async Task EditAdmin()
    {
        if (password != confirmPassword)
        {
            message = "As palavras-passe não coincidem.";
            return;
        }

        var valid = await LusiumService.ValidaNovosDadosAdministrador(userID, userName, password);

        if (valid)
        {
            await LusiumService.AtualizaDadosAdministrador(userID, userName, password);
            message = "Administrador editado com sucesso.";
        }
        else
        {
            message = "Dados inválidos. Não foi possível editar.";
        }
    }
}*@

@inject LusiumService LusiumService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<h1>Editar Administrador</h1>

<div>
    <label for="nome">Nome</label>
    <input type="text"
           class="form-control"
           id="name"
           @bind="userName"
           placeholder="@userName"
           readonly />
    <div class="form-group">
        <label for="password">Nova Palavra-passe</label>
        <input type="password" class="form-control" id="password" @bind="password" />
        <label for="confirmPassword">Confirmar Nova Palavra-passe</label>
        <input type="password" class="form-control" id="confirmPassword" @bind="confirmPassword" />
    </div>

    <button @onclick="AlterarSenha">Alterar Senha</button>

    <p>@message</p>
</div>

@code {
    [Parameter] public required string userId { get; set; }
    [Parameter] public required string userName { get; set; }

    private string password { get; set; } = string.Empty;
    private string confirmPassword { get; set; } = string.Empty;
    private string message { get; set; } = string.Empty;

    private async Task AlterarSenha()
    {
        if (password != confirmPassword)
        {
            message = "As palavras-passe não coincidem.";
            return;
        }

        var valid = await LusiumService.ValidaNovosDadosAdministrador(userId, userName, password);

        if (valid)
        {
            await LusiumService.AtualizaDadosAdministrador(userId, userName, password);
            message = "Senha alterada com sucesso.";

            await LusiumService.validateAdmin(userId);

            NavigationManager.NavigateTo("/login");
        }
        else
        {
            message = "Erro ao alterar senha.";
        }
    }
}